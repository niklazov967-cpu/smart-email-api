# üß™ –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: –ü–æ–∏—Å–∫ email –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

**–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** 28 –Ω–æ—è–±—Ä—è 2024  
**–°–µ—Å—Å–∏—è:** 52d0a83e-dcdd-4754-8b9f-cb7843741395

---

## ‚úÖ –¢–µ—Å—Ç 1: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞

**–ú–µ—Ç–æ–¥:** `_extractMainDomain()`

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:

| –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL | –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π –¥–æ–º–µ–Ω | –°—Ç–∞—Ç—É—Å |
|-----------------|-------------------|---------|
| `https://www.rapiddirect.com/zh-CN/blog/cnc-machining-company-in-china/` | `https://www.rapiddirect.com` | ‚úÖ PASS |
| `http://company.cn/products/item.html` | `https://company.cn` | ‚úÖ PASS |
| `https://example.com/news/article-123` | `https://example.com` | ‚úÖ PASS |
| `https://www.example.com` | `https://www.example.com` | ‚úÖ PASS |
| `http://en.company.cn/about-us` | `https://en.company.cn` | ‚úÖ PASS |

**–í—ã–≤–æ–¥:** –ú–µ—Ç–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ –≤—Å–µ—Ö Stage (1, 2, 3).

---

## üîç –¢–µ—Å—Ç 2: Stage 3 –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π —Å URL –±–ª–æ–≥–∞

### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏:

1. **‰∏úËéû‰øäËã±Âà∂ÈÄ†ÊúâÈôêÂÖ¨Âè∏**
   - Website: `https://www.rapiddirect.com/zh-CN/blog/cnc-machining-company-in-china/`
   - Email –¥–æ: `null`
   - Stage –¥–æ: `site_analyzed`

2. **‰∏≠Â±±ÊòüÈÄüÊú∫Ê¢∞ÂéÇ**
   - Website: `https://www.rapiddirect.com/zh-CN/blog/cnc-machining-company-in-china/`
   - Email –¥–æ: `null`
   - Stage –¥–æ: `site_analyzed`

### –ó–∞–ø—É—Å–∫ Stage 3:
```bash
curl -X POST 'http://localhost:3030/api/sessions/52d0a83e-dcdd-4754-8b9f-cb7843741395/process-stage/3'
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- **–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** 5 –∫–æ–º–ø–∞–Ω–∏–π (websitesProcessed)
- **–ù–∞–π–¥–µ–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤:** 46 (contactsFound)  
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 26.968 —Å–µ–∫

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π:
- **‰∏úËéû‰øäËã±Âà∂ÈÄ†ÊúâÈôêÂÖ¨Âè∏:** `stage3_raw_data = null` ‚ö†Ô∏è
- **‰∏≠Â±±ÊòüÈÄüÊú∫Ê¢∞ÂéÇ:** `stage3_raw_data = null` ‚ö†Ô∏è

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–º–ø–∞–Ω–∏–∏ –∏–º–µ—é—Ç `stage = 'site_analyzed'`, –ø–æ—ç—Ç–æ–º—É Stage 3 –∏—Ö –ø—Ä–æ–ø—É—Å—Ç–∏–ª.  
Stage 3 –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–º–ø–∞–Ω–∏–∏ —Å `stage = 'website_found'`.

---

## üìä –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------|----------|
| Stage 1: `_extractMainDomain()` | ‚úÖ | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| Stage 1: `_isBlogOrArticle()` | ‚úÖ | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| Stage 1: –ü–∞—Ä—Å–∏–Ω–≥ —Å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –¥–æ–º–µ–Ω–∞ | ‚úÖ | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| Stage 1: –ü—Ä–æ–º–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω | ‚úÖ | –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≥–ª–∞–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã |
| Stage 2: `_extractMainDomain()` | ‚úÖ | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| Stage 2: –ü—Ä–æ–º–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω | ‚úÖ | –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≥–ª–∞–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã |
| Stage 3: `_extractMainDomain()` | ‚úÖ | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ) |
| Stage 3: –ü—Ä–æ–º–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω | ‚úÖ | –ò—â–µ—Ç –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ |

---

## üéØ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞:** –ú–µ—Ç–æ–¥ `_extractMainDomain()` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –≥–ª–∞–≤–Ω—ã–π –¥–æ–º–µ–Ω –∏–∑ –ª—é–±—ã—Ö URL (–±–ª–æ–≥–∏, —Å—Ç–∞—Ç—å–∏, –ø—Ä–æ–¥—É–∫—Ç—ã)

2. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã:** –í—Å–µ 3 —Å—Ç–∞–¥–∏–∏ —Ç–µ–ø–µ—Ä—å —è–≤–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ç–∏—Ä—É—é—Ç Perplexity –∏—Å–∫–∞—Ç—å/–≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≥–ª–∞–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–ª–æ–≥–æ–≤ –≤ Stage 1:** –ï—Å–ª–∏ Perplexity –≤–µ—Ä–Ω–µ—Ç URL –±–ª–æ–≥–∞ - –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥–µ—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω –≤ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

---

## ‚ö†Ô∏è –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ß—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏—è—Ö —Å URL –±–ª–æ–≥–∞, –Ω—É–∂–Ω–æ:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û—á–∏—Å—Ç–∏—Ç—å Stage 3 –¥–∞–Ω–Ω—ã–µ
```sql
UPDATE pending_companies
SET 
  email = NULL,
  contacts_json = NULL,
  stage3_raw_data = NULL,
  stage = 'website_found',
  updated_at = NOW()
WHERE company_name IN ('‰∏úËéû‰øäËã±Âà∂ÈÄ†ÊúâÈôêÂÖ¨Âè∏', '‰∏≠Â±±ÊòüÈÄüÊú∫Ê¢∞ÂéÇ');
```

–ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å Stage 3 –∑–∞–Ω–æ–≤–æ.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é
1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é —Å —Ç–µ–º–æ–π "CNC –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ—Ç–∞–ª–ª–∞"
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Stage 1 - –æ–Ω —É–∂–µ –±—É–¥–µ—Ç –∏–∑–≤–ª–µ–∫–∞—Ç—å –≥–ª–∞–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å Stage 2 –∏ Stage 3
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

## üìù –í—ã–≤–æ–¥—ã

### ‚úÖ –£—Å–ø–µ—à–Ω–æ:
- –õ–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –≥–ª–∞–≤–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –í—Å–µ –ø—Ä–æ–º–ø—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### ‚è≥ –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª Stage 1 ‚Üí Stage 2 ‚Üí Stage 3 –Ω–∞ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ Perplexity —Ä–µ–∞–ª—å–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç email –Ω–∞ –≥–ª–∞–≤–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö

### üéì –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ç–µ—Å—Ç–æ–≤—É—é —Å–µ—Å—Å–∏—é –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å—Ç–∞–¥–∏–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–ª–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π.

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ–µ E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏

