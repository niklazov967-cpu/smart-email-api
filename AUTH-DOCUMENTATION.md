# üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è Smart Email API

**–í–µ—Ä—Å–∏—è:** 1.3.0  
**–î–∞—Ç–∞:** 2025-11-29  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã —Å–∞–π—Ç–∞ –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ç—Ä–∞—Ç—ã —Ç–æ–∫–µ–Ω–æ–≤ API –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–º–∏ –ª–∏—Ü–∞–º–∏.

### –ß—Ç–æ –∑–∞—â–∏—â–µ–Ω–æ:

- ‚úÖ –í—Å–µ HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`index.html`, `results.html`, `progress.html` –∏ –¥—Ä.)
- ‚úÖ –í—Å–µ API endpoints (`/api/*`)
- ‚úÖ –¢–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É

### –ß—Ç–æ –ù–ï –∑–∞—â–∏—â–µ–Ω–æ:

- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ (`/login.html`)
- ‚úÖ API –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (`/api/auth/*`)
- ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (CSS, JS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`:

```bash
# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
AUTH_USERNAME=admin
AUTH_PASSWORD=admin123
SESSION_SECRET=smart-email-api-secret-key-change-in-production
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞):

```bash
npm install express-session
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:

```bash
npm start
```

### 4. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä:

```
http://localhost:3030
```

–í–∞—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞.

---

## üîë –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É

### –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:

- **–õ–æ–≥–∏–Ω:** `admin`
- **–ü–∞—Ä–æ–ª—å:** `admin123`

### ‚ö†Ô∏è –í–ê–ñ–ù–û: –ò–∑–º–µ–Ω–∏—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!

–í —Ñ–∞–π–ª–µ `.env` –∏–∑–º–µ–Ω–∏—Ç–µ:

```bash
AUTH_USERNAME=–≤–∞—à_–ª–æ–≥–∏–Ω
AUTH_PASSWORD=–≤–∞—à_–±–µ–∑–æ–ø–∞—Å–Ω—ã–π_–ø–∞—Ä–æ–ª—å
```

---

## üõ†Ô∏è –§–∞–π–ª—ã

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. **`src/middleware/auth.js`** - Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
2. **`public/login.html`** - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
3. **`AUTH-ENV-SETUP.md`** - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. **`src/app-simple.js`** - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
2. **`package.json`** - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `express-session`

---

## üìñ API Endpoints

### POST `/api/auth/login`

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Request:**
```json
{
  "username": "admin",
  "password": "admin123"
}
```

**Response (—É—Å–ø–µ—Ö):**
```json
{
  "success": true,
  "message": "–£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"
}
```

**Response (–æ—à–∏–±–∫–∞):**
```json
{
  "success": false,
  "error": "Invalid credentials",
  "message": "–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å"
}
```

---

### POST `/api/auth/logout`

–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã.

**Response:**
```json
{
  "success": true,
  "message": "–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã"
}
```

---

### GET `/api/auth/status`

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

**Response (–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω):**
```json
{
  "success": true,
  "isAuthenticated": true,
  "username": "admin"
}
```

**Response (–Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω):**
```json
{
  "success": true,
  "isAuthenticated": false
}
```

---

## üîí –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –°–µ—Å—Å–∏–∏

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `express-session` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

```javascript
const session = require('express-session');

app.use(session({
  secret: process.env.SESSION_SECRET,
  resave: false,
  saveUninitialized: false,
  cookie: {
    maxAge: 24 * 60 * 60 * 1000 // 24 —á–∞—Å–∞
  }
}));
```

### 2. Middleware

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å–µ—Å—Å–∏—è:

```javascript
app.use((req, res, next) => {
  if (req.path.endsWith('.html') || req.path.startsWith('/api')) {
    // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å login.html –∏ auth API
    if (req.path === '/login.html' || req.path.startsWith('/api/auth')) {
      return next();
    }
    // –¢—Ä–µ–±–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
    return auth.requireAuth(req, res, next);
  }
  next();
});
```

### 3. –†–µ–¥–∏—Ä–µ–∫—Ç

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:
- **HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã** ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login.html`
- **API –∑–∞–ø—Ä–æ—Å—ã** ‚Üí HTTP 401 + JSON –æ—à–∏–±–∫–∞

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –î–æ—Å—Ç—É–ø –ë–ï–ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```bash
# –ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
curl http://localhost:3030/
# ‚Üí –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login.html

# –ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ API
curl http://localhost:3030/api
# ‚Üí {"success":false,"error":"Unauthorized"}
```

### –¢–µ—Å—Ç 2: –õ–æ–≥–∏–Ω

```bash
# –í—Ö–æ–¥ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
curl -c cookies.txt -X POST http://localhost:3030/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
# ‚Üí {"success":true,"message":"–£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"}
```

### –¢–µ—Å—Ç 3: –î–æ—Å—Ç—É–ø –ü–û–°–õ–ï –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```bash
# –î–æ—Å—Ç—É–ø –∫ API —Å cookie
curl -b cookies.txt http://localhost:3030/api
# ‚Üí {"status":"running","version":"1.3.0",...}
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Å–µ—Å—Å–∏–∏

–í `src/middleware/auth.js`:

```javascript
cookie: {
  maxAge: 7 * 24 * 60 * 60 * 1000 // 7 –¥–Ω–µ–π
}
```

### –î–æ–±–∞–≤–∏—Ç—å HTTPS (production)

```javascript
cookie: {
  secure: true,  // –¢–æ–ª—å–∫–æ –¥–ª—è HTTPS
  httpOnly: true,
  sameSite: 'strict'
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ó–∞–º–µ–Ω–∏—Ç–µ –ø—Ä–æ—Å—Ç—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `src/middleware/auth.js`:

```javascript
async handleLogin(req, res) {
  const { username, password } = req.body;
  
  // –ü–æ–ª—É—á–∏—Ç—å –∏–∑ –ë–î
  const user = await db.getUser(username);
  
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ö—ç—à –ø–∞—Ä–æ–ª—è
  const isValid = await bcrypt.compare(password, user.passwordHash);
  
  if (isValid) {
    req.session.isAuthenticated = true;
    req.session.userId = user.id;
    return res.json({ success: true });
  }
  
  return res.status(401).json({ success: false });
}
```

---

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ª–æ–≥–∏–Ω–∞

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `public/login.html`:

### –ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–æ—Ç–∏–ø:

```html
<div class="logo">
    <h1>üîê –í–∞—à–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</h1>
    <p>–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞</p>
</div>
```

### –ò–∑–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç–∞:

```css
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
/* –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–∏ —Ü–≤–µ—Ç–∞ */
```

---

## üöÄ –î–µ–ø–ª–æ–π –Ω–∞ Railway.app

### –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Railway Dashboard:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Railway Dashboard
2. Settings ‚Üí Variables
3. –î–æ–±–∞–≤—å—Ç–µ:
   ```
   AUTH_USERNAME=your_username
   AUTH_PASSWORD=your_secure_password
   SESSION_SECRET=generate-random-32-char-string
   ```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞:

```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
‚úÖ 1. –î–æ—Å—Ç—É–ø –ë–ï–ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Üí HTTP 401 / –†–µ–¥–∏—Ä–µ–∫—Ç
‚úÖ 2. API –ë–ï–ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Üí {"error":"Unauthorized"}
‚úÖ 3. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ ‚Üí HTTP 200 (–¥–æ—Å—Ç—É–ø–Ω–∞)
‚úÖ 4. –õ–æ–≥–∏–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ ‚Üí –£—Å–ø–µ—Ö
‚úÖ 5. –î–æ—Å—Ç—É–ø –ü–û–°–õ–ï –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Üí HTTP 200
‚úÖ 6. API –ü–û–°–õ–ï –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Üí –†–∞–±–æ—Ç–∞–µ—Ç

üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

1. **–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** - `admin123` –Ω–µ–±–µ–∑–æ–ø–∞—Å–µ–Ω!
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** –≤ production (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `secure: true`)
3. **–ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–π SESSION_SECRET** (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)
4. **–ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ .env** –≤ git

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

- –≠—Ç–æ –ø—Ä–æ—Å—Ç–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ø–æ–¥—Ö–æ–¥—è—â–∞—è –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
- –î–ª—è —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
  - –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–î
  - –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (bcrypt)
  - JWT —Ç–æ–∫–µ–Ω—ã
  - Rate limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç brute-force

---

## üìù –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏:

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - —Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–æ–≤
2. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è** - –æ—Ç–ø—Ä–∞–≤–∫–∞ email —Å —Å—Å—ã–ª–∫–æ–π
3. **–†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞** - admin, user, viewer
4. **–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - TOTP –∫–æ–¥—ã
5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–æ–≤** - –∏—Å—Ç–æ—Ä–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
6. **Rate limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç brute-force –∞—Ç–∞–∫

---

## üéØ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤–∞—à Smart Email API –∑–∞—â–∏—â–µ–Ω –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞!

**–î–ª—è –≤—Ö–æ–¥–∞:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3030
2. –í–≤–µ–¥–∏—Ç–µ: `admin` / `admin123`
3. –†–∞–±–æ—Ç–∞–π—Ç–µ —Å —Å–∏—Å—Ç–µ–º–æ–π

**–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤ `.env`!** üîí

