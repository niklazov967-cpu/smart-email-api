# üÜï –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ –≤–µ—Ä—Å–∏–∏ 1.1.0

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. üîç –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥-–∑–∞–ø—Ä–æ—Å–æ–≤ (Query Expansion)

–¢–µ–ø–µ—Ä—å –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –ø–æ–¥-–∑–∞–ø—Ä–æ—Å–æ–≤!

#### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–í—ã –∑–∞–¥–∞–µ—Ç–µ —Ç–µ–º—É** (–Ω–∞–ø—Ä–∏–º–µ—Ä: "‰∏çÈîàÈí¢Êï∞ÊéßËΩ¶Èì£Âä†Â∑•")
2. **–°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 10+ –≤–∞—Ä–∏–∞—Ü–∏–π**:
   - ‰∏çÈîàÈí¢Á≤æÂØÜÂä†Â∑• (–ü—Ä–µ—Ü–∏–∑–∏–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Ä–∂–∞–≤–µ—é—â–µ–π —Å—Ç–∞–ª–∏)
   - CNC‰∏çÈîàÈí¢Èõ∂‰ª∂Âä†Â∑• (CNC –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ—Ç–∞–ª–µ–π –∏–∑ –Ω–µ—Ä–∂–∞–≤–µ—é—â–µ–π —Å—Ç–∞–ª–∏)
   - ‰∏çÈîàÈí¢Ëá™Âä®ÂåñÂä†Â∑• (–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Ä–∂–∞–≤–µ—é—â–µ–π —Å—Ç–∞–ª–∏)
   - –ò —Ç.–¥.

3. **–í—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ –Ω—É–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º UI
4. **–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π**

#### –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:

- ‚úÖ **–ë–æ–ª—å—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å ‚Üí 10-15 –≤–∞—Ä–∏–∞—Ü–∏–π
- ‚úÖ **–õ—É—á—à–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** - —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ ‚Üí –±–æ–ª—å—à–µ –∫–æ–º–ø–∞–Ω–∏–π
- ‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å** - –≤—ã —Ä–µ—à–∞–µ—Ç–µ –∫–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
- ‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –≤–∞—Ä–∏–∞—Ü–∏–∏

---

### 2. üí∞ –°—á–µ—Ç—á–∏–∫ –∫—Ä–µ–¥–∏—Ç–æ–≤ Perplexity –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

–¢–µ–ø–µ—Ä—å –≤—ã –≤–∏–¥–∏—Ç–µ —Å–∫–æ–ª—å–∫–æ –¥–µ–Ω–µ–≥ —Ç—Ä–∞—Ç–∏—Ç–µ **–≤–æ –≤—Ä–µ–º—è** –ø–æ–∏—Å–∫–∞, –∞ –Ω–µ –ø–æ—Å–ª–µ!

#### –ß—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:

```
üí∞ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API (—Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤:     42
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤:  12,450
–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:    $0.1245
```

#### –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ —ç—Ç–∞–ø–∞–º:

- Stage 1 (Query Expansion): $0.0085, 850 —Ç–æ–∫–µ–Ω–æ–≤
- Stage 1 (Find Companies): $0.0102, 1,020 —Ç–æ–∫–µ–Ω–æ–≤
- Stage 2 (Find Websites): $0.0458, 4,580 —Ç–æ–∫–µ–Ω–æ–≤
- –ò —Ç.–¥.

#### API Endpoints:

```bash
# –¢–µ–∫—É—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã –¥–ª—è —Å–µ—Å—Å–∏–∏
GET /api/credits/:sessionId

# –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
GET /api/credits/stats/total

# –ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤
GET /api/credits/history?start_date=2025-11-01&end_date=2025-11-30

# –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
POST /api/credits/estimate
```

---

### 3. üé® –ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞–º–∏

**URL:** http://localhost:3030/queries.html

#### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤**
   - –í–≤–æ–¥ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–º—ã
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞—Ä–∏–∞—Ü–∏–π
   - –ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ —Ä—É—Å—Å–∫–∏–π

2. **–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –≤—ã–±–æ—Ä**
   - –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏
   - –û—Ü–µ–Ω–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ (0-100%)
   - –í–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö
   - –û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ–º–∞ –≤—Å–µ–≥–¥–∞ –≤—ã–±—Ä–∞–Ω–∞

3. **–°—á–µ—Ç—á–∏–∫ –∫—Ä–µ–¥–∏—Ç–æ–≤**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
   - –ü–æ–∫–∞–∑ total cost –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

4. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**
   - –í—ã–±—Ä–∞—Ç—å –≤—Å–µ / –°–Ω—è—Ç—å –≤—Å–µ
   - –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –≤ –ë–î

---

## üóÑÔ∏è –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ë–î

### `session_queries`

–•—Ä–∞–Ω–∏—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Å–µ—Å—Å–∏–∏:

```sql
CREATE TABLE session_queries (
    query_id UUID PRIMARY KEY,
    session_id UUID NOT NULL,
    main_topic TEXT NOT NULL,      -- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ–º–∞
    query_cn TEXT NOT NULL,        -- –ó–∞–ø—Ä–æ—Å –Ω–∞ –∫–∏—Ç–∞–π—Å–∫–æ–º
    query_ru TEXT NOT NULL,        -- –ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ —Ä—É—Å—Å–∫–∏–π
    relevance INTEGER DEFAULT 50,  -- –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å 0-100
    is_main BOOLEAN DEFAULT FALSE, -- –≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–µ–º–∞?
    is_selected BOOLEAN DEFAULT FALSE, -- –í—ã–±—Ä–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º?
    created_at TIMESTAMP
);
```

### `api_credits_log`

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API –∏ –ø–æ–¥—Å—á–µ—Ç –∫—Ä–µ–¥–∏—Ç–æ–≤:

```sql
CREATE TABLE api_credits_log (
    log_id UUID PRIMARY KEY,
    session_id UUID,
    stage TEXT NOT NULL,           -- –≠—Ç–∞–ø –æ–±—Ä–∞–±–æ—Ç–∫–∏
    request_tokens INTEGER,        -- –¢–æ–∫–µ–Ω—ã –≤ –∑–∞–ø—Ä–æ—Å–µ
    response_tokens INTEGER,       -- –¢–æ–∫–µ–Ω—ã –≤ –æ—Ç–≤–µ—Ç–µ
    total_tokens INTEGER,          -- –í—Å–µ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤
    cost_usd DECIMAL(10, 6),       -- –°—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD
    model_name TEXT,               -- –ú–æ–¥–µ–ª—å API
    timestamp TIMESTAMP
);
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏—è `search_sessions`

–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è:
- `total_cost_usd` - –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏
- `total_requests` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üì° –ù–æ–≤—ã–µ API Endpoints

### Topics API (`/api/topics`)

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥-–∑–∞–ø—Ä–æ—Å–æ–≤
POST /api/topics
Body: {
  "main_topic": "‰∏çÈîàÈí¢Êï∞ÊéßËΩ¶Èì£Âä†Â∑•",
  "target_count": 10
}

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–µ—Å—Å–∏–∏
POST /api/topics/:sessionId/generate
Body: { "target_count": 10 }

# –ü–æ–ª—É—á–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å–µ—Å—Å–∏–∏
GET /api/topics/:sessionId/queries

# –û–±–Ω–æ–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
PUT /api/topics/:sessionId/select
Body: { "query_ids": ["uuid1", "uuid2", ...] }

# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
GET /api/topics/:sessionId/selected
```

### Credits API (`/api/credits`)

```bash
# –†–∞—Å—Ö–æ–¥—ã –¥–ª—è —Å–µ—Å—Å–∏–∏
GET /api/credits/:sessionId

# –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
GET /api/credits/stats/total

# –ò—Å—Ç–æ—Ä–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥
GET /api/credits/history?start_date=...&end_date=...&group_by=day

# –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
POST /api/credits/estimate
Body: {
  "model_name": "llama-3.1-sonar-large-128k-online",
  "estimated_tokens": 1000
}

# –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (SSE)
GET /api/credits/:sessionId/realtime
```

---

## üîß –ù–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã

### `QueryExpander`

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–¥-–∑–∞–ø—Ä–æ—Å—ã –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–º—ã:

```javascript
const result = await queryExpander.expandTopic(
  "‰∏çÈîàÈí¢Êï∞ÊéßËΩ¶Èì£Âä†Â∑•", 
  10  // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞—Ü–∏–π
);

// result.queries = [
//   {
//     query_cn: "‰∏çÈîàÈí¢Á≤æÂØÜÂä†Â∑•",
//     query_ru: "–ü—Ä–µ—Ü–∏–∑–∏–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Ä–∂–∞–≤–µ—é—â–µ–π —Å—Ç–∞–ª–∏",
//     relevance: 85,
//     is_main: false
//   },
//   ...
// ]
```

### `CreditsTracker`

–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ä–∞—Å—Ö–æ–¥—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º API –≤—ã–∑–æ–≤–µ
await creditsTracker.logApiCall(
  sessionId,
  'stage1_find_companies',
  500,  // request tokens
  1500, // response tokens
  'llama-3.1-sonar-large-128k-online'
);

// –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã
const costs = await creditsTracker.getSessionCosts(sessionId);
// {
//   total_cost: 0.1245,
//   total_requests: 42,
//   total_tokens: 12450,
//   formatted_cost: "$0.1245",
//   breakdown: [...]
// }
```

---

## üìä Workflow (–Ω–æ–≤—ã–π)

### –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã:

```
1. –ó–∞–¥–∞—Ç—å —Ç–µ–º—É
   ‚Üì
2. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥-–∑–∞–ø—Ä–æ—Å—ã (Query Expansion)
   ‚Üì
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏ –≤—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
   ‚Üì
4. –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é
   ‚Üì
5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É
   ‚Üì
6. –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å + –∫—Ä–µ–¥–∏—Ç—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
   ‚Üì
7. –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```bash
# 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
curl -X POST http://localhost:3030/api/topics \
  -H "Content-Type: application/json" \
  -d '{
    "main_topic": "‰∏çÈîàÈí¢Êï∞ÊéßËΩ¶Èì£Âä†Â∑•",
    "target_count": 10
  }'

# –û—Ç–≤–µ—Ç: { queries: [...], total: 11 }

# 2. –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã
curl -X POST http://localhost:3030/api/sessions \
  -H "Content-Type: application/json" \
  -d '{
    "search_query": "‰∏çÈîàÈí¢Êï∞ÊéßËΩ¶Èì£Âä†Â∑•",
    "target_count": 50
  }'

# –ü–æ–ª—É—á–∏—Ç—å session_id

# 3. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Å–µ—Å—Å–∏–∏
curl -X POST http://localhost:3030/api/topics/{session_id}/generate \
  -d '{"target_count": 10}'

# 4. –í—ã–±—Ä–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ UI
# http://localhost:3030/queries.html?session={session_id}

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É
curl -X POST http://localhost:3030/api/sessions/{session_id}/process

# 6. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã
curl http://localhost:3030/api/credits/{session_id}
```

---

## üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏

### –î–æ (v1.0.0):
- ‚ùå –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å = –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- ‚ùå –ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–∞—Ä–∏–∞—Ü–∏–∏
- ‚ùå –í–∏–¥–∏—à—å —Ä–∞—Å—Ö–æ–¥—ã —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- ‚ùå –°–ª–æ–∂–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞—Ä–∞–Ω–µ–µ

### –ü–æ—Å–ª–µ (v1.1.0):
- ‚úÖ **10+ –≤–∞—Ä–∏–∞—Ü–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**
- ‚úÖ **–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ —Ä—É—Å—Å–∫–∏–π** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å** - –≤—ã–±–∏—Ä–∞–µ—à—å –Ω—É–∂–Ω—ã–µ
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**
- ‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ä–∞—Å—Ö–æ–¥–æ–≤** –ø–æ —ç—Ç–∞–ø–∞–º
- ‚úÖ **–û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏** –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

---

## üéØ –¶–µ–Ω—ã Perplexity API (2025)

| –ú–æ–¥–µ–ª—å | Request | Response |
|--------|---------|----------|
| sonar-small | $0.20/1M | $0.20/1M |
| **sonar-large** (default) | **$1.00/1M** | **$1.00/1M** |
| sonar-huge | $5.00/1M | $5.00/1M |

### –¢–∏–ø–∏—á–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã (sonar-large):

- **Query Expansion** (10 –∑–∞–ø—Ä–æ—Å–æ–≤): ~$0.01
- **Stage 1** (–ø–æ–∏—Å–∫ –∫–æ–º–ø–∞–Ω–∏–π): ~$0.01
- **Stage 2** (–ø–æ–∏—Å–∫ —Å–∞–π—Ç–æ–≤, 10 –∫–æ–º–ø–∞–Ω–∏–π): ~$0.05
- **Stage 3** (–∞–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤): ~$0.03
- **Stage 4** (–æ–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥): ~$0.03
- **Stage 5** (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–≥–æ–≤): ~$0.02

**–ò—Ç–æ–≥–æ –Ω–∞ 10 –∫–æ–º–ø–∞–Ω–∏–π: ~$0.15**

---

## üìù –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `src/services/QueryExpander.js` ‚≠ê
- `src/services/CreditsTracker.js` ‚≠ê
- `src/api/topics.js` ‚≠ê
- `src/api/credits.js` ‚≠ê
- `public/queries.html` ‚≠ê
- `database/migrations/003-query-expansion.sql` ‚≠ê
- `CHANGELOG.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª) ‚≠ê

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `package.json` - –≤–µ—Ä—Å–∏—è 1.1.0, —Å—Å—ã–ª–∫–∞ –Ω–∞ GitHub
- `src/app-simple.js` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- `src/database/MockDatabase.js` - –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- `src/services/SonarApiClient.js` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CreditsTracker
- `public/index.html` - —Å—Å—ã–ª–∫–∞ –Ω–∞ queries.html

---

## üöÄ Migration Guide

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å 1.0.0 ‚Üí 1.1.0:

1. **–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥:**
   ```bash
   git pull origin main
   npm install
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:**
   ```bash
   node database/migrate.js
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä:**
   ```bash
   node src/app-simple.js
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
   - http://localhost:3030 - –≥–ª–∞–≤–Ω–∞—è
   - http://localhost:3030/queries.html - –Ω–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚≠ê

---

## ‚ú® –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

```bash
# 1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞–º–∏
http://localhost:3030/queries.html

# 2. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –Ω–∞ –∫–∏—Ç–∞–π—Å–∫–æ–º
"‰∏çÈîàÈí¢Êï∞ÊéßËΩ¶Èì£Âä†Â∑•"

# 3. –ù–∞–∂–º–∏—Ç–µ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã"
# –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—Å—Ç 10+ –≤–∞—Ä–∏–∞—Ü–∏–π —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏

# 4. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
# –û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ–º–∞ –≤—ã–±—Ä–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

# 5. –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—ã–±–æ—Ä"

# 6. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ session_id –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

# 7. –ù–∞–±–ª—é–¥–∞–π—Ç–µ —Ä–∞—Å—Ö–æ–¥—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏!
```

---

**–í–µ—Ä—Å–∏—è:** 1.1.0  
**–î–∞—Ç–∞:** November 26, 2025  
**GitHub:** https://github.com/niklazov967-cpu/smart-email-api

